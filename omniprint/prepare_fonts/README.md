# Font preparation

### What to do

On linux/MacOS system, the simplest to do is

```zsh
./pipeline.sh
```

Alternatively, sequentially run the following commands:

```zsh
python3 download_fonts.py
python3 build_font_directory.py -d ../alphabets/fine
```

On the tested machine, the script `download_fonts.py` took about 4-20 minutes, the script `build_font_directory.py` took about 65 minutes. In total, the expected executation time ranges from 65 minutes to 90 minutes. The execution time of the first command partly depends on internet connection. 

The script `download_fonts.py` not only downloads the fonts from the predefined URL list, it also does some cleaning and formatting. Some metadata will also be generated to keep track of the sources of each font. 

During the download, some temporary files will be created, they will be cleaned once the process is done. 

At the end of the second script, the temporary directory which includes all downloaded fonts and other files will be deleted by default in order to save space. If you wish to keep this temporary directory, please do the following:

```zsh
python3 build_font_directory.py -d ../alphabets/fine --keep_temporary_directory
```


### Metadata

`predefined_url_list.txt`: one URL per line, the order of each URL corresponds to URL's id.

The id of URL is the ranking in `predefined_url_list.txt`.

The metadata generated by `download_fonts.py` include:

* `font2url_id.pkl`: pickled python dictionary object which maps a font file name (`str`) to a `list` of URL's id (`int`)
* `url_id2font.pkl`: pickled python dictionary object which maps a URL's id (`int`) to a `list` of font file names (`str`)
* `log_download.csv`: dataframe whose columns are `URL_id`, `URL`, `successful_download`, `download_UTC_time`, `exception_type`, `exception`. The number of lines equals the number of lines of `predefined_url_list.txt`. 
* `cjk_file_name_table.csv`: dataframe which keeps track of renaming of file names which contain CJK character.


### NotoCJK fonts

The function `configure_NotoCJK_fonts` specifically configures NotoCJK fonts.

This is necessary because Chinese characters, Korean Hanja and Japanese Kanji can share the same Unicode code point while they can look dissimilar in different languages. This can lead to harmful results in our context, for example, even if NotoSansCJKjp-Regular.otf support (simplified) Chinese characters, they will render the characters in the Japanese way. We should only use its counterpart NotoSansCJKsc-Regular.otf to render simplified Chinese characters.

On the other hand, Korean Hangul is supported by NotoSansCJKjp-Regular.otf and NotoSansCJKkr-Regular.otf at the same time, which may result in redundancy. It is the same for Japanese hiragana and Japanese katakana. 




